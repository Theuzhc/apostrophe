{"_id":"express-cache-on-demand","_rev":"29-af7d0ed43baa56fd1a4a737454396dba","name":"express-cache-on-demand","description":"Express middleware providing on-demand caching in high traffic situations.","dist-tags":{"latest":"1.0.3"},"versions":{"0.1.0":{"name":"express-cache-on-demand","version":"0.1.0","keywords":["express","cache","performance","cache","on","demand"],"author":{"name":"P'unk Avenue LLC"},"license":"MIT","_id":"express-cache-on-demand@0.1.0","maintainers":[{"name":"boutell","email":"boutell@boutell.com"}],"homepage":"https://github.com/punkave/express-cache-on-demand","bugs":{"url":"https://github.com/punkave/express-cache-on-demand/issues"},"dist":{"shasum":"e68fea83e80409959210fc81c3af5bbdeb61b426","tarball":"https://registry.npmjs.org/express-cache-on-demand/-/express-cache-on-demand-0.1.0.tgz","integrity":"sha512-2LjKRIarfqU+t9Gb+YW9CfXfZB+0fC/LLplLMHPvA2etoh4GBUtmsSw4jXEte7/l+ltI+EnaIAz9kv6R2sFyZw==","signatures":[{"sig":"MEQCIG139+m0j2idvj4o6997hRCwvJNO7s7RqlKnyBmVEOzsAiByz1LxYIcieaDNZdF+bb+FZn3u15Up0TT2bmJ3aUMCXw==","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}]},"main":"index.js","_from":".","_shasum":"e68fea83e80409959210fc81c3af5bbdeb61b426","gitHead":"6c973efa73d5df62dd1e10665fbfec091e9a3e87","scripts":{"test":"(cd test; mocha test)"},"_npmUser":{"name":"boutell","email":"boutell@boutell.com"},"repository":{"url":"https://github.com/punkave/express-cache-on-demand","type":"git"},"_npmVersion":"1.4.24","description":"Express middleware providing on-demand caching in high traffic situations.","directories":{},"dependencies":{"lodash":"^2.4.1","cache-on-demand":"^0.2.0"},"devDependencies":{"express":"^4.9.8","request":"^2.45.0"}},"0.1.1":{"name":"express-cache-on-demand","version":"0.1.1","keywords":["express","cache","performance","cache","on","demand"],"author":{"name":"P'unk Avenue LLC"},"license":"MIT","_id":"express-cache-on-demand@0.1.1","maintainers":[{"name":"boutell","email":"boutell@boutell.com"}],"homepage":"https://github.com/punkave/express-cache-on-demand","bugs":{"url":"https://github.com/punkave/express-cache-on-demand/issues"},"dist":{"shasum":"81627e3f6f88779774d94068f0fe9012e4e400a8","tarball":"https://registry.npmjs.org/express-cache-on-demand/-/express-cache-on-demand-0.1.1.tgz","integrity":"sha512-hXHzYKm5+8p75exCvZoO6qcwVrJULEvfUIeLGBy7FkiYFnBxdslofMM3J/pzugJSzpvil0YDl76GjQilw3jcBg==","signatures":[{"sig":"MEQCIHzuFzihbXC/m8aq9FCDHk3uXu9+vMSckn77tgzggVp8AiArJ8aMLFKAoOkI1JCrxJHcngeLwphXK0LxsiV01Zg8Sg==","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}]},"main":"index.js","_from":".","_shasum":"81627e3f6f88779774d94068f0fe9012e4e400a8","gitHead":"5f52cb16f37041b7a1887f0be06f9a5249239a0a","scripts":{"test":"(cd test; mocha test)"},"_npmUser":{"name":"boutell","email":"boutell@boutell.com"},"repository":{"url":"https://github.com/punkave/express-cache-on-demand","type":"git"},"_npmVersion":"1.4.24","description":"Express middleware providing on-demand caching in high traffic situations.","directories":{},"dependencies":{"lodash":"^2.4.1","cache-on-demand":"^0.2.0"},"devDependencies":{"express":"^4.9.8","request":"^2.45.0"}},"1.0.0":{"name":"express-cache-on-demand","version":"1.0.0","keywords":["express","cache","performance","cache","on","demand"],"author":{"name":"P'unk Avenue LLC"},"license":"MIT","_id":"express-cache-on-demand@1.0.0","maintainers":[{"name":"boutell","email":"boutell@boutell.com"}],"homepage":"https://github.com/punkave/express-cache-on-demand","bugs":{"url":"https://github.com/punkave/express-cache-on-demand/issues"},"dist":{"shasum":"39532302cb26c41f88fed423cb3f368c86ae3a65","tarball":"https://registry.npmjs.org/express-cache-on-demand/-/express-cache-on-demand-1.0.0.tgz","integrity":"sha512-C63jrHd7sac3wOaREuEdKANkPaHVsNlZXdMIF4Wzob4yFsaQwm2ay58GX+PQNEWyrxY/ENR6F6/7/NsLnUHVyA==","signatures":[{"sig":"MEQCIA0QeM+LjtAUa614a/xONhtP7Uf6Nf2nNn5QGZfyVFCXAiBrcmgvcw3fUJGiTIjsiiNlzLRe0cCJTJ6OjYw+cOCLgA==","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}]},"main":"index.js","_from":".","_shasum":"39532302cb26c41f88fed423cb3f368c86ae3a65","gitHead":"5182a3868942a94f27820e072738cbf51c677ea2","scripts":{"test":"(cd test; mocha test)"},"_npmUser":{"name":"boutell","email":"boutell@boutell.com"},"repository":{"url":"git+https://github.com/punkave/express-cache-on-demand.git","type":"git"},"_npmVersion":"3.6.0","description":"Express middleware providing on-demand caching in high traffic situations.","directories":{},"_nodeVersion":"0.10.41","dependencies":{"lodash":"^2.4.1","cache-on-demand":"^0.2.0"},"devDependencies":{"express":"^4.9.8","request":"^2.45.0"},"_npmOperationalInternal":{"tmp":"tmp/express-cache-on-demand-1.0.0.tgz_1475846650104_0.5371614794712514","host":"packages-12-west.internal.npmjs.com"}},"1.0.1":{"name":"express-cache-on-demand","version":"1.0.1","keywords":["express","cache","performance","cache","on","demand"],"author":{"name":"P'unk Avenue LLC"},"license":"MIT","_id":"express-cache-on-demand@1.0.1","maintainers":[{"name":"boutell","email":"boutell@boutell.com"}],"homepage":"https://github.com/punkave/express-cache-on-demand","bugs":{"url":"https://github.com/punkave/express-cache-on-demand/issues"},"dist":{"shasum":"e3bfdb6b94b2bed44aaab28653e41d3a352ddaf6","tarball":"https://registry.npmjs.org/express-cache-on-demand/-/express-cache-on-demand-1.0.1.tgz","integrity":"sha512-14VmKU9+jLhwCVwcq/gRZNLkqh9AV0OKnUFpmaF/dN/Yd8tdHnxbt9XUShomHff5G8W4zCnKrVms4gtOkQYFoQ==","signatures":[{"sig":"MEYCIQDP87j139lLnWchTd2tUEWL51RQ1LLrwntZrreRjaOBCgIhAN5/3Jy7uApvHAPcXI7cCTthGYDvf4qJNEPGB26c946b","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}]},"main":"index.js","_from":".","_shasum":"e3bfdb6b94b2bed44aaab28653e41d3a352ddaf6","gitHead":"3c1c6d0d60395429f1ef94087cf7d688cf185ada","scripts":{"test":"(cd test; mocha test)"},"_npmUser":{"name":"boutell","email":"boutell@boutell.com"},"repository":{"url":"git+https://github.com/punkave/express-cache-on-demand.git","type":"git"},"_npmVersion":"3.6.0","description":"Express middleware providing on-demand caching in high traffic situations.","directories":{},"_nodeVersion":"0.10.41","dependencies":{"lodash":"^4.0.0","cache-on-demand":"^1.0.0"},"devDependencies":{"express":"^4.9.8","request":"^2.45.0"},"_npmOperationalInternal":{"tmp":"tmp/express-cache-on-demand-1.0.1.tgz_1475846917116_0.8397574359551072","host":"packages-12-west.internal.npmjs.com"}},"1.0.2":{"name":"express-cache-on-demand","version":"1.0.2","keywords":["express","cache","performance","cache","on","demand"],"author":{"name":"P'unk Avenue LLC"},"license":"MIT","_id":"express-cache-on-demand@1.0.2","maintainers":[{"name":"mtthwmnc","email":"matthew.mance@gmail.com"},{"name":"alexbea","email":"alex.bea@gmail.com"},{"name":"colpanik","email":"kerry@punkave.com"},{"name":"boutell","email":"tom@punkave.com"}],"homepage":"https://github.com/punkave/express-cache-on-demand","bugs":{"url":"https://github.com/punkave/express-cache-on-demand/issues"},"dist":{"shasum":"e1e0d7159868869bfb7f32fc12f1b9614da5570a","tarball":"https://registry.npmjs.org/express-cache-on-demand/-/express-cache-on-demand-1.0.2.tgz","integrity":"sha512-F+N1tHlhuK02Ntpe/Pz1CPQSy95U+JdTGQRPWmJVhQIfL/yuMSNUDaRB7AA3vycKhUUG0+UjdfcT+AVBpHRNSw==","signatures":[{"sig":"MEUCIQDwFIlLU2r/7HLoyrZLWBM1FbdRfauVOmDrey0BHlBKnQIgXifjVFzG+hjBxKh6tZllCJaCqymjy3LjX9sry6kyDQE=","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}]},"main":"index.js","gitHead":"d40ff6d7b382e3067b167f8262cc829dd70287b0","scripts":{"test":"(cd test; mocha test)"},"_npmUser":{"name":"boutell","email":"tom@punkave.com"},"repository":{"url":"git+https://github.com/punkave/express-cache-on-demand.git","type":"git"},"_npmVersion":"5.5.1","description":"Express middleware providing on-demand caching in high traffic situations.","directories":{},"_nodeVersion":"6.10.3","dependencies":{"lodash":"^4.0.0","cache-on-demand":"^1.0.0"},"devDependencies":{"express":"^4.9.8","request":"^2.45.0"},"_npmOperationalInternal":{"tmp":"tmp/express-cache-on-demand-1.0.2.tgz_1510926259649_0.8684026533737779","host":"s3://npm-registry-packages"}},"1.0.3":{"name":"express-cache-on-demand","version":"1.0.3","keywords":["express","cache","performance","cache","on","demand"],"author":{"name":"P'unk Avenue LLC"},"license":"MIT","_id":"express-cache-on-demand@1.0.3","maintainers":[{"name":"alexgilbert","email":"alex@apostrophecms.com"},{"name":"stuartromanek","email":"stuart@punkave.com"},{"name":"boutell","email":"tom@apostrophecms.com"},{"name":"alexbea","email":"abea@mailbox.org"},{"name":"gregvanbrug","email":"greg.vanbrug@gmail.com"},{"name":"valjed","email":"vjeudy@protonmail.com"},{"name":"romanek","email":"stuart+npm@apostrophecms.com"},{"name":"falkodev","email":"anthony@apostrophecms.com"},{"name":"mtthwmnc","email":"matthew.mance@gmail.com"},{"name":"breyell","email":"breyell@gmail.com"}],"homepage":"https://github.com/punkave/express-cache-on-demand","bugs":{"url":"https://github.com/punkave/express-cache-on-demand/issues"},"dist":{"shasum":"b1d4c522c23b3bea78090c970137b29795271154","tarball":"https://registry.npmjs.org/express-cache-on-demand/-/express-cache-on-demand-1.0.3.tgz","fileCount":7,"integrity":"sha512-Nq/vGu1CVOV/oB8PmKJ0/VQkZwy0dC3PkEek7FxuNyPCMFJPjeCOQQcO14/BNusGMXwfUuyFxunY4ICCVZ09ag==","signatures":[{"sig":"MEUCIATVzq7fMNR2cZVbN8YmSArzelR3XiJPbAi2osQkCg/uAiEA2Q1SDinRSile9klm/JoHHCnd+xZfS8xfj1+ozhHt7oE=","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}],"unpackedSize":18559,"npm-signature":"-----BEGIN PGP SIGNATURE-----\r\nVersion: OpenPGP.js v4.10.10\r\nComment: https://openpgpjs.org\r\n\r\nwsFzBAEBCAAGBQJiD8KMACEJED1NWxICdlZqFiEECWMYAoorWMhJKdjhPU1b\r\nEgJ2VmrWbg//Z7NpiBEOqEZuA5pYEAVM6RW6PUeiMwHYkkJUXqbAwnk2jmJz\r\nOtV//pWN5EJ2uCvMYN1FoqMEuySnHUNDH3ynfi2JZMVWCj3/zndTIjBjVt+X\r\nckq9yP2zkDW/XBUcSkF1A8KcPzfVISbwSr4h7qWbBATeJ2GxgniwtH8cWLz6\r\nvscDxI7YtDfXktEnnvmWWTe522h/AdeQfuQEsoPTX2Iw04bZv5CQnVMc/f6Z\r\n7utXRVfO6eywpzR6wt/3PlJ20ih2rV3wZ4zPoki1ETZ8009GPfQ9OZdyrDG+\r\naaFjtkY8bAgkKPXUhvdKK0C/+R0rwsvAoE6aHCRvCb4dDif7SxdlZqlNKFVM\r\npPvDJw+l2oIe54G9Ss+2Ezs+nkaQPCj/YVkh8GuQG2cqR+iH7L03frGlFBMX\r\n1EBUpEH7q2075I/z6s4L82kiawK3Wy5WHN1enPf2Jsg3N8DGf/qrX5xbOpj3\r\nsDxpbduUsxUA4AdPslN0NbHiAsTHYLuo9tRYXi/65koqTtjN+uhC0PJCSCTb\r\n/iEV7YS21WlBaNIOY9q/IQ+FRlh2WzaFWdLSL27Tr9DLthdhxtWymBCZH9LB\r\nA4u63TBDAUh9OF1RkoCds/h1yMm8LoRUNRRxLXdYZu7nI2zWf9YfwwzCTtMl\r\nv0yRl3jnEAu7rMjGdysOZpG0Bh3nem2/kpY=\r\n=+S/c\r\n-----END PGP SIGNATURE-----\r\n"},"main":"index.js","gitHead":"4d9927b8021fae9aac81a7871bc6fcc5ba08f77d","scripts":{"lint":"eslint .","test":"(cd test; mocha test)"},"_npmUser":{"name":"boutell","email":"tom@apostrophecms.com"},"repository":{"url":"git+https://github.com/punkave/express-cache-on-demand.git","type":"git"},"_npmVersion":"6.14.15","description":"Express middleware providing on-demand caching in high traffic situations.","directories":{},"_nodeVersion":"16.13.1","dependencies":{"lodash":"^4.0.0","cache-on-demand":"^1.0.0"},"_hasShrinkwrap":false,"devDependencies":{"mocha":"^9.2.0","eslint":"^8.9.0","express":"^4.9.8","request":"^2.45.0","eslint-plugin-node":"^11.1.0","eslint-plugin-import":"^2.25.4","eslint-plugin-promise":"^6.0.0","eslint-config-standard":"^16.0.3","eslint-plugin-standard":"^5.0.0","eslint-config-apostrophe":"^3.4.1"},"_npmOperationalInternal":{"tmp":"tmp/express-cache-on-demand_1.0.3_1645200012598_0.20153770979297359","host":"s3://npm-registry-packages"}}},"time":{"created":"2014-10-19T01:35:37.133Z","modified":"2024-07-02T17:40:10.930Z","0.1.0":"2014-10-19T01:35:37.133Z","0.1.1":"2014-10-22T15:01:10.542Z","1.0.0":"2016-10-07T13:24:11.640Z","1.0.1":"2016-10-07T13:28:39.023Z","1.0.2":"2017-11-17T13:44:20.479Z","1.0.3":"2022-02-18T16:00:12.791Z"},"maintainers":[{"email":"haroun.npm@icloud.com","name":"haroun"},{"email":"robert@robertmeans.net","name":"bodonkey"},{"email":"etldev@tuta.io","name":"etlaurent"},{"email":"alex@apostrophecms.com","name":"alexgilbert"},{"email":"stuart@punkave.com","name":"stuartromanek"},{"email":"tom@apostrophecms.com","name":"boutell"},{"email":"vjeudy@protonmail.com","name":"valjed"},{"email":"stuart+npm@apostrophecms.com","name":"romanek"},{"email":"greg.vanbrug@gmail.com","name":"gregvanbrug"},{"email":"anthony@apostrophecms.com","name":"falkodev"},{"email":"abea@mailbox.org","name":"alexbea"},{"email":"matthew.mance@gmail.com","name":"mtthwmnc"},{"email":"breyell@gmail.com","name":"breyell"}],"author":{"name":"P'unk Avenue LLC"},"repository":{"url":"git+https://github.com/punkave/express-cache-on-demand.git","type":"git"},"keywords":["express","cache","performance","cache","on","demand"],"license":"MIT","homepage":"https://github.com/punkave/express-cache-on-demand","bugs":{"url":"https://github.com/punkave/express-cache-on-demand/issues"},"readme":"# express-cache-on-demand\n\n<a href=\"http://apostrophenow.org/\"><img src=\"https://raw.githubusercontent.com/punkave/express-cache-on-demand/master/logos/logo-box-madefor.png\" align=\"right\" /></a>\n\nExpress middleware providing \"on demand\" caching that kicks in only when requests arrive simultaneously.\n\n## Install\n\n```\nnpm install express-cache-on-demand\n```\n\n## Example\n\n```javascript\nvar expressCacheOnDemand = require('express-cache-on-demand')();\n\n// Fetch a page from a database and build fancy\n// navigation, then render the template; this is\n// just an example of a big, possibly slow task.\n// Use the expressCacheOnDemand middleware to\n// send the same response to all simultaneous\n// requests.\n\napp.get('/:page', expressCacheOnDemand, function(req, res) {\n  return getPage(req.params.page, function(page) {\n    return addFancyNavigation(page, function(links) {\n      return res.render('page.html', { links: links });\n    });\n  });\n});\n\n```\nUnder light load, with requests arriving far apart, every request for a given `req.url` will get an individually generated response, which gives them the newest content. This is the same behavior you see without the middleware.\n\nBut under heavy load, with new requests arriving while the first request is still being processed, the additional requests are queued up. When the first response is ready, it is simply sent to all of them. And then the response is discarded, so that the next request to arrive will generate a new response with the latest content.\n\nThis gives us \"on demand\" caching. The server is still allowed to generate new responses often, just not many of them simultaneously. It is the shortest practical lifetime for cached data and largely eliminates concerns about users seeing old content, as well as concerns about cache memory management.\n\n## When to use it, when not to\n\nThis middleware is intended for routes that potentially take a long time to generate a relatively small response (under a megabyte, let's say). Dynamic web pages with lots of complicated moving parts are a perfect example.\n\nYou should *not* use this middleware for your entire site. In particular:\n\n* It does not work and is not suitable anyway for routes that deliver entire files via `res.sendFile` and related methods\n* It does not work and is not suitable anyway for routes that `pipe` content into `res`\n* It shouldn't be registered globally before the `express.static` middleware\n\nThere may be other possible endings for an Express `res` object that are not properly handled by this middleware yet. Pull requests welcome.\n\n## When we cache, when we don't\n\nBy default, the middleware only caches requests when:\n\n* `req.method` is `GET` or `HEAD`.\n* `req.user` is falsy.\n* `req.session` is empty (*).\n\nIf the above conditions are not met, every request will generate its own response. This way we don't cause surprising behavior for logged-in users who are modifying site content and seeing personalized displays.\n\n(*) The middleware is smart enough to ignore a few special cases, such as `req.session.cookie`, an empty `req.session.flash`, and an empty `req.session.passport`.\n\n## Deciding when to cache on your own\n\nIf you don't like our rules for caching, you can write your own. Just pass a function that returns `false` for requests that should not be hashed, and a hash key such as `req.url` for requests that should be hashed.\n\n```javascript\nvar expressCacheOnDemand =\n  require('express-cache-on-demand')(hasher);\n\nfunction hasher(req) {\n  if (req.url.match(/nevercacheme/)) {\n    return false;\n  }\n  return req.url;\n}\n```\n\n## Using `cache-on-demand` for other tasks\n\nThis module is an Express middleware wrapper for our [cache-on-demand](https://github.com/punkave/cache-on-demand) module. If you would like to do the same trick with code that isn't powered by Express, try using that module directly.\n\n## About P'unk Avenue and Apostrophe\n\n`express-cache-on-demand` was created at [P'unk Avenue](http://punkave.com) for use in many projects built with Apostrophe, an open-source content management system built on node.js. If you like `cache-on-demand` you should definitely [check out apostrophecms.org](http://apostrophecms.org).\n\n## Support\n\nFeel free to open issues on [github](http://github.com/punkave/express-cache-on-demand).\n\n<a href=\"http://punkave.com/\"><img src=\"https://raw.githubusercontent.com/punkave/express-cache-on-demand/master/logos/logo-box-builtby.png\" /></a>\n\n## Changelog\n\n### CHANGES IN 1.0.3\n\n* The default hash function now correctly refuses to cache in the documented circumstances (i.e. logged-in users or a nontrivial `req.session` object). Previously a `return false` was missing, resulting in the possibility of a cached result going to a user with a different session.\n* `var` has been eliminated and the code has been lightly refactored without other changes to behavior.\n\n### CHANGES IN 1.0.2\n\n`res.getHeader` support. Thanks to Vadim Fedorov.\n\n### CHANGES IN 1.0.1\n\n`cache-on-demand` is now at 1.0.0 also, plus the lodash dependency now points to a modern release. No functional changes.\n### CHANGES IN 1.0.0\n\n`redirect` now supports the optional status code argument properly. Thanks to Alexey Astafiev.\n\nThis module has been in successful production use for many moons, so we're declaring it stable (1.0.0).\n\n### CHANGES IN 0.1.1\n\nFixed a bug in `redirect` support, which now works properly.\n\n### CHANGES IN 0.1.0\n\nInitial release. With shiny unit tests, of course.\n","readmeFilename":"README.md"}